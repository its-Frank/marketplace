<%- include('_header') %>
<div class="container mt-5">
  <h1 class="mb-4">Service Management</h1>

  <% if (locals.successMessage) { %>
  <div class="alert alert-success" role="alert"><%= successMessage %></div>
  <% } %>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Seller</th>
        <th>Status</th>
        <th>Price</th>
        <th>Category</th>
        <th>Description</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if (services && services.length > 0) { %> <%
      services.forEach(function(service) { %>
      <tr>
        <td><%= service.id %></td>
        <td><%= service.title %></td>
        <td><%= service.seller_name %></td>
        <td><%= service.status %></td>
        <td>$<%= service.price.toFixed(2) %></td>
        <td><%= service.category %></td>
        <td>
          <% if (service.description) { %> <%= service.description.length > 50 ?
          service.description.substring(0, 50) + '...' : service.description %>
          <% } else { %> N/A <% } %>
        </td>
        <td>
          <div class="btn-group" role="group">
            <button
              type="button"
              class="btn btn-info btn-sm"
              data-toggle="modal"
              data-target="#serviceDetailsModal<%= service.id %>"
            >
              View
            </button>
            <form
              action="/admin/services/delete/<%= service.id %>"
              method="POST"
              style="display: inline"
            >
              <button
                type="submit"
                class="btn btn-danger btn-sm"
                onclick="return confirm('Are you sure you want to delete this service?')"
              >
                Delete
              </button>
            </form>
          </div>
        </td>
      </tr>
      <!-- Modal for Service Details -->
      <div
        class="modal fade"
        id="serviceDetailsModal<%= service.id %>"
        tabindex="-1"
        role="dialog"
        aria-labelledby="serviceDetailsLabel<%= service.id %>"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="serviceDetailsLabel<%= service.id %>">
                Service Details
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p><strong>ID:</strong> <%= service.id %></p>
              <p><strong>Title:</strong> <%= service.title %></p>
              <p><strong>Seller:</strong> <%= service.seller_name %></p>
              <p><strong>Status:</strong> <%= service.status %></p>
              <p><strong>Price:</strong> $<%= service.price.toFixed(2) %></p>
              <p><strong>Category:</strong> <%= service.category %></p>
              <p>
                <strong>Description:</strong> <%= service.description || 'No
                description provided' %>
              </p>
              <p>
                <strong>Created At:</strong> <%= service.created_at ? new
                Date(service.created_at).toLocaleString() : 'N/A' %>
              </p>
            </div>
          </div>
        </div>
      </div>
      <% }); %> <% } else { %>
      <tr>
        <td colspan="8" class="text-center">No services found.</td>
      </tr>
      <% } %>
    </tbody>
  </table>
</div>
<%- include('_footer') %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Example: Confirm before deleting a service
    const deleteButtons = document.querySelectorAll(".btn-danger");
    deleteButtons.forEach((button) => {
      button.addEventListener("click", function (e) {
        if (!confirm("Are you sure you want to delete this service?")) {
          e.preventDefault();
        }
      });
    });
  });
</script>
